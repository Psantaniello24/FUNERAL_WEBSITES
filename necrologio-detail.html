<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Necrologio - Onoranze Funebri Santaniello</title>
    <meta name="description" content="Dettagli necrologio. Invia le tue condoglianze alla famiglia. Onoranze Funebri Santaniello." id="page-description">
    <meta name="keywords" content="necrologio, condoglianze, agenzia funebre, Santaniello">
    
    <!-- Facebook App ID (richiesto per il debugger) -->
    <meta property="fb:app_id" content="YOUR_FACEBOOK_APP_ID">
    
    <!-- Open Graph meta tags per condivisione social (Facebook, WhatsApp) -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Necrologio - Onoranze Funebri Santaniello" id="og-title">
    <meta property="og:description" content="Dettagli necrologio. Invia le tue condoglianze alla famiglia." id="og-description">
    <meta property="og:image" content="https://tuosito.it/images/placeholder-person.svg" id="og-image">
    <meta property="og:url" content="" id="og-url">
    
    <!-- Meta tag aggiuntivi per ottimizzazione condivisione -->
    <meta property="og:site_name" content="Onoranze Funebri Santaniello">
    <meta property="og:locale" content="it_IT">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Necrologio - Onoranze Funebri Santaniello" id="og-image-alt">
    <meta property="og:image:type" content="image/jpeg">
    
    <!-- Meta tag per Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Necrologio - Onoranze Funebri Santaniello" id="twitter-title">
    <meta name="twitter:description" content="Dettagli necrologio. Invia le tue condoglianze alla famiglia." id="twitter-description">
    <meta name="twitter:image" content="https://tuosito.it/images/placeholder-person.svg" id="twitter-image">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'funeral-dark': '#1a1a2e',
                        'funeral-blue': '#16213e',
                        'funeral-gold': '#d4af37',
                        'funeral-gray': '#8b8b8b'
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome per le icone -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Firebase SDK for data loading -->
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50">
    <!-- Loading State -->
    <div id="loading-screen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-gray-800 font-semibold">Caricamento necrologio...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-gradient-to-br from-gray-600 via-gray-500 to-gray-700 text-white shadow-2xl relative">
        <!-- Overlay decorativo -->
        <div class="absolute inset-0 bg-gradient-to-br from-gray-800 via-transparent to-gray-600 opacity-40"></div>
        
        <!-- Elementi decorativi -->
        <div class="absolute top-0 left-0 w-32 h-32 bg-gray-700 rounded-full opacity-20 -translate-x-16 -translate-y-16"></div>
        <div class="absolute bottom-0 right-0 w-48 h-48 bg-gray-600 rounded-full opacity-10 translate-x-24 translate-y-24"></div>
        
        <div class="container mx-auto px-4 relative z-10">
            <!-- Top bar -->
            <div class="py-3 text-sm border-b border-gray-600 border-opacity-30">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-6">
                        <span class="flex items-center"><i class="fas fa-phone text-gray-300 mr-2"></i> +39 081 8234914</span>
                        <span class="flex items-center"><i class="fas fa-envelope text-gray-300 mr-2"></i> santanielloservizifunebri@gmail.com</span>
                    </div>
                    <div class="text-gray-300 flex items-center">
                        <span class="mr-4"><i class="fas fa-clock mr-1"></i> Disponibili 24/7</span>
                        <a href="admin.html" class="text-gray-300 hover:text-white transition-colors">
                            <i class="fas fa-cog"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Main navigation -->
            <nav class="py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold text-gray-300">
                            <i class="fas fa-dove text-lg mr-2"></i>
                            <a href="index.html">Santaniello</a>
                        </h1>
                        <span class="ml-3 text-sm text-gray-300">Agenzia Funebre</span>
                    </div>
                    
                    <!-- Desktop Menu -->
                    <ul class="hidden md:flex space-x-6 items-center">
                        <li><a href="index.html" class="hover:text-white transition-colors">Home</a></li>
                        <li><a href="necrologi.html" class="text-gray-300">Necrologi</a></li>
                        <li><a href="fiori-omaggi.html" class="hover:text-white transition-colors">Fiori & Omaggi</a></li>
                        <li><a href="chi-siamo.html" class="hover:text-white transition-colors">Chi Siamo</a></li>
                        <li><a href="casa-funeraria.html" class="hover:text-white transition-colors">Casa Funeraria</a></li>
                        <li><a href="servizi.html" class="hover:text-white transition-colors">Servizi</a></li>
                        <li><a href="contatti.html" class="hover:text-white transition-colors">Contatti</a></li>
                    </ul>
                    
                    <!-- Mobile Menu Button -->
                    <button class="md:hidden text-white" id="mobile-menu-btn">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
                
                <!-- Mobile Menu -->
                <div class="md:hidden mt-4 hidden" id="mobile-menu">
                    <ul class="space-y-2 pb-4">
                        <li><a href="index.html" class="block py-2 hover:text-white transition-colors">Home</a></li>
                        <li><a href="necrologi.html" class="block py-2 text-gray-300">Necrologi</a></li>
                        <li><a href="fiori-omaggi.html" class="block py-2 hover:text-white transition-colors">Fiori & Omaggi</a></li>
                        <li><a href="chi-siamo.html" class="block py-2 hover:text-white transition-colors">Chi Siamo</a></li>
                        <li><a href="casa-funeraria.html" class="block py-2 hover:text-white transition-colors">Casa Funeraria</a></li>
                        <li><a href="servizi.html" class="block py-2 hover:text-white transition-colors">Servizi</a></li>
                        <li><a href="contatti.html" class="block py-2 hover:text-white transition-colors">Contatti</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <!-- Breadcrumb -->
    <section class="py-4 bg-white border-b">
        <div class="container mx-auto px-4">
            <nav class="breadcrumb">
                <a href="index.html">Home</a>
                <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                <a href="necrologi.html">Necrologi</a>
                <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
                <span id="breadcrumb-name">Caricamento...</span>
            </nav>
        </div>
    </section>

    <!-- Main Content -->
    <main class="py-12" id="main-content">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <!-- Main obituary card -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-8">
                    <div class="p-8">
                        <div class="flex flex-col lg:flex-row items-start lg:items-center space-y-6 lg:space-y-0 lg:space-x-8">
                            <!-- Photo -->
                            <div class="flex-shrink-0">
                                <img id="obituary-photo" src="images/placeholder-person.svg" alt="Foto" class="w-64 h-80 object-cover rounded-lg shadow-md">
                            </div>
                            
                            <!-- Details -->
                            <div class="flex-1">
                                <h1 id="obituary-name" class="text-4xl font-bold text-gray-800 mb-4">Caricamento...</h1>
                                
                                <div class="space-y-3 text-lg mb-6" id="obituary-details">
                                    <p class="flex items-center">
                                        <i class="fas fa-calendar text-gray-300 mr-3 w-5"></i>
                                        <span class="font-semibold mr-2">Nato:</span>
                                        <span id="birth-date">...</span>
                                    </p>
                                    <p class="flex items-center">
                                        <i class="fas fa-heart text-gray-300 mr-3 w-5"></i>
                                        <span class="font-semibold mr-2">Chiamato alla Casa del Padre:</span>
                                        <span id="death-date">...</span>
                                    </p>
                                    <p class="flex items-center">
                                        <i class="fas fa-map-marker-alt text-gray-300 mr-3 w-5"></i>
                                        <span class="font-semibold mr-2">Comune:</span>
                                        <span id="obituary-city">...</span>
                                    </p>
                                    <p class="flex items-center">
                                        <i class="fas fa-hourglass text-gray-300 mr-3 w-5"></i>
                                        <span class="font-semibold mr-2">Et√†:</span>
                                        <span id="obituary-age">...</span>
                                    </p>
                                    <p class="flex items-center" id="marital-status-row" style="display: none;">
                                        <i class="fas fa-ring text-gray-300 mr-3 w-5"></i>
                                        <span class="font-semibold mr-2">Stato Civile:</span>
                                        <span id="obituary-marital-status">...</span>
                                    </p>
                                </div>
                                
                                <!-- Funeral details -->
                                <div class="bg-gradient-to-r from-gray-300 to-gray-400 bg-opacity-20 p-6 rounded-lg">
                                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                        <i class="fas fa-church text-gray-300 mr-2"></i>
                                        Cerimonia Funebre
                                    </h2>
                                    <div class="space-y-2" id="funeral-details">
                                        <p><span class="font-semibold">Data:</span> <span id="funeral-date">...</span></p>
                                        <p><span class="font-semibold">Ora:</span> <span id="funeral-time">...</span></p>
                                        <p><span class="font-semibold">Luogo:</span> <span id="funeral-location">...</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Memorial Text -->
                <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-heart text-gray-300 mr-3"></i>
                        In Memoria
                    </h2>
                    <div class="prose prose-lg max-w-none text-gray-700">
                        <p id="obituary-description" class="text-xl leading-relaxed mb-6">
                            Caricamento descrizione...
                        </p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <button 
                            onclick="openCondolenceFormDetail()" 
                            class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:from-gray-400 hover:to-gray-500 transition-colors flex items-center justify-center"
                            id="condolence-btn"
                        >
                            <i class="fas fa-heart mr-3"></i>
                            Invia Condoglianze
                        </button>
                        <a 
                            href="fiori-omaggi.html" 
                            class="flex-1 bg-gradient-to-r from-gray-600 to-gray-700 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:from-gray-500 hover:to-gray-600 hover:text-white transition-colors flex items-center justify-center"
                        >
                            <i class="fas fa-flower mr-3"></i>
                            Fiori & Omaggi
                        </a>
                        <button 
                            onclick="shareObituary()" 
                            class="flex-1 bg-gray-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:bg-gray-700 transition-colors flex items-center justify-center"
                        >
                            <i class="fas fa-share-alt mr-3"></i>
                            Condividi
                        </button>
                    </div>
                </div>

                <!-- Condolences Section -->
                <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-comments text-gray-300 mr-3"></i>
                        Condoglianze <span id="condolences-count" class="text-lg font-normal text-gray-500">(0)</span>
                    </h2>
                    
                    <div id="condolences-list">
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-heart text-3xl mb-4 text-gray-300"></i>
                            <p>Nessuna condoglianza ancora. Sii il primo a lasciare un messaggio di cordoglio.</p>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-gray-800 to-gray-700 text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-8">
                <!-- Brand -->
                <div>
                    <h3 class="font-bold text-xl mb-4 text-gray-300">
                        <i class="fas fa-dove mr-2"></i>
                        Santaniello
                    </h3>
                    <p class="text-gray-300 mb-4">Agenzia Funebre di fiducia dal 1950. Professionalit√†, rispetto e vicinanza alle famiglie nel momento del dolore.</p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-google"></i></a>
                    </div>
                </div>
                
                <!-- Servizi -->
                <div>
                    <h4 class="font-semibold mb-4 text-gray-300">Servizi</h4>
                    <ul class="text-gray-300 space-y-2 text-sm">
                        <li><a href="servizi.html" class="hover:text-white">Servizi Funebri</a></li>
                        <li><a href="casa-funeraria.html" class="hover:text-white">Casa Funeraria</a></li>
                        <li><a href="fiori-omaggi.html" class="hover:text-white">Fiori e Omaggi</a></li>
                        <li><a href="#" class="hover:text-white">Cremazione</a></li>
                        <li><a href="#" class="hover:text-white">Trasporto Salme</a></li>
                    </ul>
                </div>
                
                <!-- Informazioni -->
                <div>
                    <h4 class="font-semibold mb-4 text-gray-300">Informazioni</h4>
                    <ul class="text-gray-300 space-y-2 text-sm">
                        <li><a href="chi-siamo.html" class="hover:text-white">Chi Siamo</a></li>
                        <li><a href="necrologi.html" class="hover:text-white">Necrologi</a></li>
                        <li><a href="#" class="hover:text-white">Privacy Policy</a></li>
                        <li><a href="#" class="hover:text-white">Cookie Policy</a></li>
                    </ul>
                </div>
                
                <!-- Contatti -->
                <div>
                    <h4 class="font-semibold mb-4 text-gray-300">Contatti</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                        <p><i class="fas fa-phone mr-2"></i> +39 081 8234914</p>
                        <p><i class="fas fa-envelope mr-2"></i> santanielloservizifunebri@gmail.com</p>
                        <p><i class="fas fa-map-marker-alt mr-2"></i> Via Cimitile 4<br> 80035 Nola (NA), Italia</p>
                        <p><i class="fas fa-clock mr-2"></i> Disponibili 24/7</p>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-600 mt-8 pt-8 text-center text-sm text-gray-400">
                <p>&copy; 2024 Santaniello Servizi Funebri. Tutti i diritti riservati.</p>
                <p class="text-sm mt-2">
                    Iscritto al registro delle imprese della regione Campania n. 471 | P.I. 10320801219
                </p>
            </div>
        </div>
    </footer>

    <script src="js/supabase-config.js"></script>
    <script src="js/main.js"></script>
    <script src="js/necrologio-detail.js"></script>
    <script>
        // Funzione per aggiornare i meta tag Open Graph dinamicamente
        function updateMetaTags(obituary) {
            if (!obituary) return;
            
            const name = obituary.nome || obituary.name || 'Defunto';
            const description = `Ci ha lasciati ${name}, sempre nei nostri cuori.`;
            const title = `In memoria di ${name}`;
            
            // Gestione intelligente dell'immagine del defunto per Open Graph
            let imageUrl = 'https://tuosito.it/images/placeholder-person.svg'; // fallback
            
            // Priorit√† 1: URL pubblico da Supabase Storage (photoURL)
            if (obituary.photoURL && obituary.photoURL.startsWith('http') && !obituary.photoURL.includes('placeholder')) {
                imageUrl = obituary.photoURL;
                console.log('üì∏ Usando photoURL di Supabase per meta tags:', imageUrl);
            }
            // Priorit√† 2: URL foto generico (foto field) se √® un URL valido
            else if (obituary.foto && obituary.foto.startsWith('http') && !obituary.foto.includes('placeholder')) {
                imageUrl = obituary.foto;
                console.log('üì∏ Usando obituary.foto (URL pubblico) per meta tags:', imageUrl);
            }
            // Priorit√† 3: Se foto √® un path relativo, lo convertiamo in assoluto
            else if (obituary.foto && !obituary.foto.includes('placeholder') && !obituary.foto.startsWith('data:')) {
                imageUrl = obituary.foto.startsWith('/') ? `https://tuosito.it${obituary.foto}` : `https://tuosito.it/${obituary.foto}`;
                console.log('üì∏ Usando obituary.foto (path convertito) per meta tags:', imageUrl);
            }
            // NOTA: Non usiamo photoFile.data (base64) perch√© Facebook non supporta immagini base64
            else {
                console.log('üì∏ Nessuna foto pubblica trovata, usando placeholder per meta tags');
                // Verifica se c'√® un'immagine base64 che dovrebbe essere caricata su storage
                if (obituary.photoFile && obituary.photoFile.data && obituary.photoFile.data.startsWith('data:')) {
                    console.warn('‚ö†Ô∏è ATTENZIONE: Trovata immagine base64 che non pu√≤ essere usata per Open Graph');
                    console.warn('üí° Suggerimento: L\'immagine dovrebbe essere salvata su Supabase Storage per essere condivisibile');
                }
            }
            
            const pageUrl = window.location.href;
            
            // Aggiorna title e meta description
            document.getElementById('page-title').textContent = title;
            document.getElementById('page-description').setAttribute('content', description);
            
            // Aggiorna Open Graph tags
            document.getElementById('og-title').setAttribute('content', title);
            document.getElementById('og-description').setAttribute('content', description);
            document.getElementById('og-image').setAttribute('content', imageUrl);
            document.getElementById('og-url').setAttribute('content', pageUrl);
            document.getElementById('og-image-alt').setAttribute('content', `${title} - Onoranze Funebri Santaniello`);
            
            // Aggiorna Twitter Card tags
            document.getElementById('twitter-title').setAttribute('content', title);
            document.getElementById('twitter-description').setAttribute('content', description);
            document.getElementById('twitter-image').setAttribute('content', imageUrl);
            
            console.log('‚úÖ Meta tags aggiornati per:', name);
            console.log('üì∏ Debug immagine meta tags:', {
                hasPhotoFile: !!obituary.photoFile,
                hasPhotoFileData: !!(obituary.photoFile && obituary.photoFile.data),
                photoFileType: obituary.photoFile?.data?.substring(0, 20) + '...',
                foto: obituary.foto,
                photoURL: obituary.photoURL,
                finalImageUrl: imageUrl,
                isBase64: imageUrl.startsWith('data:'),
                isHttp: imageUrl.startsWith('http'),
                isPlaceholder: imageUrl.includes('placeholder'),
                isSupabaseUrl: imageUrl.includes('supabase.co')
            });
            
            // Avviso se stiamo usando il placeholder
            if (imageUrl.includes('placeholder')) {
                console.warn('‚ö†Ô∏è ATTENZIONE: Usando immagine placeholder per Open Graph');
                console.warn('üí° Per una condivisione ottimale, carica una foto reale del defunto');
            }
        }
        
        // Initialize dynamic obituary page
        document.addEventListener('DOMContentLoaded', function() {
            // The loading screen will be hidden by the obituary detail page once data is loaded
            console.log('Dynamic obituary page loaded');
            
            // Ascolta per l'evento di caricamento del necrologio
            window.addEventListener('obituaryLoaded', function(event) {
                updateMetaTags(event.detail);
            });
        });
        
        // Robust condolence function
        function openCondolenceFormDetail() {
            console.log('üîÑ Condolence form requested...');
            
            // Check if obituaryDetailPage is available
            if (!window.obituaryDetailPage || !window.obituaryDetailPage.obituary) {
                console.error('‚ùå ObituaryDetailPage or obituary not available');
                alert('Pagina ancora in caricamento. Riprova tra un momento.');
                return;
            }
            
            const obituary = window.obituaryDetailPage.obituary;
            console.log('‚úÖ Opening condolence form for:', obituary.nome);
            
            // Create modal directly here
            const modal = document.createElement('div');
            modal.className = 'modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.id = 'condolence-modal-detail';
            
            modal.innerHTML = `
                <div class="modal-content bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-funeral-dark">Condoglianze per ${obituary.nome}</h3>
                        <button onclick="closeCondolenceModal()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <img src="${obituary.foto || 'images/placeholder-person.svg'}" alt="${obituary.nome}" class="w-16 h-20 object-cover rounded">
                            <div>
                                <p class="font-bold text-funeral-dark text-lg">${obituary.nome}</p>
                                <p class="text-sm text-gray-600">${obituary.dataNascita} - ${obituary.dataMorte}</p>
                                <p class="text-sm text-gray-500">${obituary.eta} anni, ${obituary.comune}</p>
                            </div>
                        </div>
                    </div>
                    
                    <form id="condolence-form" onsubmit="submitCondolence(event)">
                        <input type="hidden" name="obituary_id" value="${obituary.id}">
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-funeral-dark mb-2">
                                <i class="fas fa-user mr-1"></i> Nome *
                            </label>
                            <input type="text" name="nome" required class="w-full p-3 border border-gray-300 rounded-lg focus:border-funeral-gold focus:ring-2 focus:ring-funeral-gold/20 transition-all">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-funeral-dark mb-2">
                                <i class="fas fa-envelope mr-1"></i> Email
                            </label>
                            <input type="email" name="email" class="w-full p-3 border border-gray-300 rounded-lg focus:border-funeral-gold focus:ring-2 focus:ring-funeral-gold/20 transition-all">
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-funeral-dark mb-2">
                                <i class="fas fa-heart mr-1"></i> Messaggio di Condoglianze *
                            </label>
                            <textarea name="messaggio" required rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:border-funeral-gold focus:ring-2 focus:ring-funeral-gold/20 transition-all resize-none" placeholder="Scrivi qui il tuo messaggio di cordoglio..."></textarea>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button type="button" onclick="closeCondolenceModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition-colors">
                                <i class="fas fa-times mr-2"></i> Annulla
                            </button>
                            <button type="submit" class="flex-1 bg-gradient-to-r from-funeral-gold to-yellow-600 text-funeral-dark py-3 rounded-lg font-semibold hover:from-yellow-400 hover:to-yellow-500 transition-colors">
                                <i class="fas fa-heart mr-2"></i> Invia Condoglianze
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // Focus on first input
            setTimeout(() => {
                const firstInput = modal.querySelector('input[name="nome"]');
                if (firstInput) firstInput.focus();
            }, 100);
        }
        
        function closeCondolenceModal() {
            const modal = document.getElementById('condolence-modal-detail');
            if (modal) {
                modal.remove();
                document.body.style.overflow = 'auto';
            }
        }
        
        function submitCondolence(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const condolence = {
                nome: formData.get('nome'),
                email: formData.get('email'),
                messaggio: formData.get('messaggio'),
                data: new Date().toISOString()
            };
            
            console.log('üìù Condolence submitted:', condolence);
            
            // Simulate success
            alert('Condoglianze inviate con successo. Grazie per il tuo messaggio.');
            closeCondolenceModal();
        }
    </script>
</body>
</html>